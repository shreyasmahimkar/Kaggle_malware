__author__ = 'shreyas'
'''
Count ??, 00 - FF from byte file
count the size of asm and byte file
'''
import os

def countInstances(trainlabels, traindatafolder):
    f1 = open(trainlabels)
    f1.readline() # skip 1st line
    typeoflines = ['size_asm', 'size_bytes']
    num = 0
    while num != 256:
        typeoflines.append(str(format(num, '02x').upper()))
        num = num + 1
    writefile = open("feature2.csv", "w")
    writefile.write("ID")
    count = 0
    for item in typeoflines:
        writefile.write(','+item)
    for line1 in f1:
        name = line1.split(',')[0]
        name = name.replace('"','')
        count_lines = {}
        for item in typeoflines:
            count_lines[item] = 0
        count_lines[typeoflines[0]] = os.path.getsize(traindatafolder+name+'.asm')
        count_lines[typeoflines[1]] = os.path.getsize(traindatafolder+name+'.bytes')
        f2 = open(traindatafolder+name+'.bytes', encoding = "ISO-8859-1")
        for line2 in f2:
            line2=line2.replace('\n','')
            dyn_list = line2.split(' ')
            for val in typeoflines[2:]:
                for val1 in dyn_list:
                    if val.__eq__(val1):
                        count_lines[val] = count_lines[val] + 1
        print(count)
        count = count + 1
        writefile.write("\n")
        writefile.write(name)
        for item in typeoflines:
            writefile.write(","+str(count_lines[item]))






'''
Types of lines in .asm
1) .text
2) .rdata
3) .data
4) .idata
'''
def readfile(trainlabels, traindatafolder):
    f1 = open(trainlabels)
    f1.readline() # skip 1st line
    typeoflines = ['.text','.rdata','.data', '.idata']
    writefile = open("feature1.csv", "w")
    writefile.write("ID")
    count = 0
    for item in typeoflines:
        writefile.write(","+item)
    for line1 in f1:
        name = line1.split(',')[0]
        count_lines = {}
        for item in typeoflines:
            count_lines[item] = 0
        name = name.replace('"','')
        f2 = open(traindatafolder+name+'.asm', encoding = "ISO-8859-1")
        for line2 in f2:
            for val in typeoflines:
                if line2.split(':')[0].__contains__(val):
                    count_lines[val] = count_lines[val] + 1
                    break
        #print(name+str(count_lines))
        print(count)
        count = count + 1
        writefile.write("\n")
        writefile.write(name)
        for item in typeoflines:
            writefile.write(","+str(count_lines[item]))




