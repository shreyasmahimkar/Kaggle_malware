import re
from collections import defaultdict
import numpy as np
import pandas as pd
from pandas.io.parsers import read_csv
from pylab import *
import os
from random import sample

filepath_X = 'X.txt'
df = read_csv(filepath_or_buffer =filepath_X, header=0, sep=',')
df['op1_sum'] = sum(df[df.columns[2:19]],axis = 1)
for col in df.columns[2:19]:
    df[col+'_pc'] = df[col]/df['op1_sum']
    df.drop(col,axis = 1, inplace = True)
df['op2_sum'] = sum(df[df.columns[2:155]],axis = 1)
for col in df.columns[2:155]:
    df[col+'_pc'] = df[col]/df['op2_sum']
    df.drop(col,axis = 1, inplace = True)
    
filepath1 = 'creating features/countlines_train.csv'
df1= read_csv(filepath_or_buffer =filepath1, header=0, sep=',')
df1['line_sum'] = sum(df1[[1,2,3,4]],axis = 1)
for col in df1.columns[1:5]:
    df1[col+'_pc'] = df1[col]/df1['line_sum']
    df1.drop(col,axis = 1, inplace = True)
df = pd.merge(df,df1,left_on='Id',right_on = 'ID')
df.drop('ID',axis = 1, inplace = True)

path, dirs, files = os.walk("creating features/size_??_00_FF_train").next()
pieces = []
for i,filename in enumerate(files):
    pieces.append(read_csv(filepath_or_buffer =path+'/'+filename, header=0, sep=','))
    pieces[i].rename(columns={'0':'00','1':'01','2':'02','3':'03','4':'04','5':'05','6':'06','7':'07','8':'08','9':'09'},inplace=True)
df_temp = pd.concat(pieces)
df_temp['2b_sum'] = sum(df_temp[df_temp.columns[3:]],axis = 1)
for col in df_temp.columns[3:(-1)]:
    df_temp[col+'_pc'] = df_temp[col]/df_temp['2b_sum']
    df_temp.drop(col,axis = 1, inplace = True)
df = pd.merge(df,df_temp,left_on='Id',right_on = 'ID')
df.drop('ID',axis = 1, inplace = True)

" convert NaN to 0 "
for col in df.columns[2:]:
    df[col][isnan(df[col])]=0
    df[col][isinf(df[col])]=0